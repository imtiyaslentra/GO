local Stats = game:GetService('Stats')
local Players = game:GetService('Players')
local RunService = game:GetService('RunService')
local ReplicatedStorage = game:GetService('ReplicatedStorage')
local Celery_Util = loadstring(game:HttpGet('https://raw.githubusercontent.com/CeleryHub/CeleryHub/main/CeleUtil.lua'))()
local local_player = Players.LocalPlayer
local camera = workspace.CurrentCamera
local celery_Data, closest_Entity, parry_remote = nil, nil, nil -- Global Settings

-- Global settings
getgenv().aura_Enabled = false
getgenv().hit_effect_Enabled = false
getgenv().night_mode_Enabled = false
getgenv().self_effect_Enabled = false
getgenv().auto_parry_Enabled = false
getgenv().auto_spam_Enabled = false

local Services = { game:GetService('AdService'), game:GetService('SocialService') } -- UI Library
local OrionLib = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Orion/main/source'))()
local Window = OrionLib:MakeWindow({ Name = "Lunar Premium Blade Ball", HidePremium = true, SaveConfig = true, ConfigFolder = "cElerytEst" })
local Tab = Window:MakeTab({ Name = "Main", Icon = "rbxassetid://4483345998", PremiumOnly = false })
local Tab3 = Window:MakeTab({ Name = "Visuals", Icon = "rbxassetid://4483345998", PremiumOnly = false })

-- Initialize the script
initialize("Celery_Data")
optimizePerformance()

-- Toggle untuk Aura
Tab:Toggle({
    Name = "Aura",
    Default = false,
    Callback = function(value)
        getgenv().aura_Enabled = value
        print(value and "Aura Enabled" or "Aura Disabled")
    end
})

-- Toggle untuk Hit Effect
Tab:Toggle({
    Name = "Hit Effect",
    Default = false,
    Callback = function(value)
        getgenv().hit_effect_Enabled = value
        print(value and "Hit Effect Enabled" or "Hit Effect Disabled")
    end
})

-- Toggle untuk Auto Parry
Tab:Toggle({
    Name = "Auto Parry",
    Default = false,
    Callback = function(value)
        getgenv().auto_parry_Enabled = value
        print(value and "Auto Parry Enabled" or "Auto Parry Disabled")
    end
})

-- Toggle untuk Auto Spam
Tab:Toggle({
    Name = "Auto Spam",
    Default = false,
    Callback = function(value)
        getgenv().auto_spam_Enabled = value
        print(value and "Auto Spam Enabled" or "Auto Spam Disabled")
    end
})

-- Toggle untuk Night Mode
Tab3:Toggle({
    Name = "Night Mode",
    Default = false,
    Callback = function(value)
        getgenv().night_mode_Enabled = value
        print(value and "Night Mode Enabled" or "Night Mode Disabled")
    end
})

-- Toggle untuk Self Effect
Tab3:Toggle({
    Name = "Self Effect",
    Default = false,
    Callback = function(value)
        getgenv().self_effect_Enabled = value
        print(value and "Self Effect Enabled" or "Self Effect Disabled")
    end
})

-- Closest Entity
local function getClosestEntity(Object)
    local closest
    local max_distance = math.huge
    for _, entity in ipairs(workspace.Alive:GetChildren()) do
        if entity.Name ~= local_player.Name then
            local distance = (Object.Position - entity.HumanoidRootPart.Position).Magnitude
            if distance < max_distance then
                closest = entity
                max_distance = distance
            end
        end
    end
    return closest
end

-- Resolve Parry Remote
local function resolveParryRemote()
    for _, service in ipairs(Services) do
        local temp_remote = service:FindFirstChildOfClass('RemoteEvent')
        if temp_remote and temp_remote.Name:find('\n') then
            parry_remote = temp_remote
            break
        end
    end
end

-- Aura Table
local aura_table = {
    canParry = true,
    is_Spamming = false,
    parry_Range = 15,
    spam_Range = 8,
    hit_Count = 0,
    hit_Time = tick(),
    ball_Warping = tick(),
    is_ball_Warping = false,
    target_Dead = false -- New variable to track if the target is dead
}

-- Event Listeners
ReplicatedStorage.Remotes.ParrySuccess.OnClientEvent:Connect(function()
    if getgenv().hit_effect_Enabled then
        local hit_effect = game:GetObjects("rbxassetid://18894222844")[1]
        hit_effect.Parent = Celery_Util.getBall()
        hit_effect:Emit(3)
        task.delay(5, function() hit_effect:Destroy() end)
    end
end)

ReplicatedStorage.Remotes.ParrySuccessAll.OnClientEvent:Connect(function()
    aura_table.hit_Count += 1
    task.delay(0.15, function() aura_table.hit_Count -= 1 end)
end)

workspace:WaitForChild("Balls").ChildRemoved:Connect(function()
    aura_table.hit_Count = 0
    aura_table.is_ball_Warping = false
    aura_table.is_Spamming = false
end)

-- Detect when the target dies
workspace.Alive.ChildRemoved:Connect(function(child)
    if child == closest_Entity then
        aura_table.target_Dead = true
        aura_table.is_Spamming = false -- Stop spamming when the target is dead
    end
end)

-- Initialize the script
initialize("Celery_Data")
optimizePerformance()

-- Inisialisasi Orion Library
OrionLib:Init()
print("Orion Library initialized")
