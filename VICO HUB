local ImGui = loadstring(game:HttpGet("https://raw.githubusercontent.com/depthso/Roblox-ImGUI/main/ImGui.lua"))()

if not ImGui then
    error("Failed to load ImGui library.")
end

print("ImGui loaded successfully.")

local window = ImGui:New({Title = "Blade Ball AutoParry & AutoSpam", Size = Vector2.new(300, 200)})

local isAutoParryEnabled = false
local isAutoSpamEnabled = false

window:AddButton("Toggle Auto Parry", function()
    isAutoParryEnabled = not isAutoParryEnabled
    print("Auto Parry: ", isAutoParryEnabled and "ON" or "OFF")
end)

window:AddButton("Toggle Auto Spam", function()
    isAutoSpamEnabled = not isAutoSpamEnabled
    print("Auto Spam: ", isAutoSpamEnabled and "ON" or "OFF")
end)

local attackSpeed = 0.1
window:AddSlider("Spam Speed", 0.05, 1, function(value)
    attackSpeed = value
    print("Attack Speed: ", attackSpeed)
end)

window:Ready()

local parryEvent = game.ReplicatedStorage:WaitForChild("ParryEvent")
local attackEvent = game.ReplicatedStorage:WaitForChild("AttackEvent")

if not parryEvent or not attackEvent then
    error("ParryEvent or AttackEvent not found in ReplicatedStorage.")
end

local local_player = game.Players.LocalPlayer
local lastParryTime = tick()
local parryThrottle = 0.1

local function getClosestEntity()
    local closest
    local max_distance = math.huge
    for _, entity in ipairs(workspace.Alive:GetChildren()) do
        if entity.Name ~= local_player.Name and entity:FindFirstChild("HumanoidRootPart") then
            local distance = (local_player.Character.PrimaryPart.Position - entity.HumanoidRootPart.Position).Magnitude
            if distance < max_distance then
                closest = entity
                max_distance = distance
            end
        end
    end
    return closest
end

local function autoParry()
    while isAutoParryEnabled do
        local closest_Entity = getClosestEntity()
        if closest_Entity and tick() - lastParryTime >= parryThrottle then
            parryEvent:FireServer(
                0.5,
                CFrame.new(workspace.CurrentCamera.CFrame.Position, closest_Entity.HumanoidRootPart.Position),
                {[closest_Entity.Name] = closest_Entity.HumanoidRootPart.Position}
            )
            lastParryTime = tick()
        end
        wait(0.1)
    end
end

local function autoSpam()
    while isAutoSpamEnabled do
        attackEvent:FireServer()
        wait(attackSpeed)
    end
end

coroutine.wrap(function()
    while true do
        if isAutoParryEnabled then
            autoParry()
        end
        wait(0.1)
    end
end)()

coroutine.wrap(function()
    while true do
        if isAutoSpamEnabled then
            autoSpam()
        end
        wait(0.1)
    end
end)()
