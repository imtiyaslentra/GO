-- Memuat ImGui Library dari URL
local ImGui = loadstring(game:HttpGet("https://raw.githubusercontent.com/depthso/Roblox-ImGUI/refs/heads/main/ImGui.lua"))()

if not ImGui then
    error("Failed to load ImGui library.")
end

print("ImGui loaded successfully.")

-- Membuat window GUI utama
local window = ImGui:New({Title = "Blade Ball AutoParry & AutoSpam", Size = Vector2.new(300, 200)})

-- Tombol untuk AutoParry dan AutoSpam
local isAutoParryEnabled = false
local isAutoSpamEnabled = false

window:AddButton("Toggle Auto Parry", function()
    isAutoParryEnabled = not isAutoParryEnabled
    print("Auto Parry: ", isAutoParryEnabled and "ON" or "OFF")
end)

window:AddButton("Toggle Auto Spam", function()
    isAutoSpamEnabled = not isAutoSpamEnabled
    print("Auto Spam: ", isAutoSpamEnabled and "ON" or "OFF")
end)

-- Menambahkan slider untuk mengatur kecepatan serangan
local attackSpeed = 0.1
window:AddSlider("Spam Speed", 0.05, 1, function(value)
    attackSpeed = value
    print("Attack Speed: ", attackSpeed)
end)

window:Ready() -- Memulai GUI

-- Event parry dan attack dari ReplicatedStorage
local parryEvent = game.ReplicatedStorage:WaitForChild("ParryEvent")
local attackEvent = game.ReplicatedStorage:WaitForChild("AttackEvent")

if not parryEvent or not attackEvent then
    error("ParryEvent or AttackEvent not found in ReplicatedStorage.")
end

-- Data entitas terdekat
local local_player = game.Players.LocalPlayer
local lastParryTime = tick()
local parryThrottle = 0.1 -- Throttle untuk Parry

-- Fungsi untuk menemukan entitas terdekat
local function getClosestEntity()
    local closest
    local max_distance = math.huge
    for _, entity in ipairs(workspace.Alive:GetChildren()) do
        if entity.Name ~= local_player.Name and entity:FindFirstChild("HumanoidRootPart") then
            local distance = (local_player.Character.PrimaryPart.Position - entity.HumanoidRootPart.Position).Magnitude
            if distance < max_distance then
                closest = entity
                max_distance = distance
            end
        end
    end
    return closest
end

-- Fungsi untuk Auto Parry dengan throttle
local function autoParry()
    while isAutoParryEnabled do
        local closest_Entity = getClosestEntity() -- Mendapatkan entitas terdekat
        if closest_Entity and tick() - lastParryTime >= parryThrottle then
            parryEvent:FireServer(
                0.5,
                CFrame.new(workspace.CurrentCamera.CFrame.Position, closest_Entity.HumanoidRootPart.Position),
                {[closest_Entity.Name] = closest_Entity.HumanoidRootPart.Position}
            )
            lastParryTime = tick()
        end
        wait(0.1) -- Tunggu sejenak sebelum mencoba lagi
    end
end

-- Fungsi untuk Auto Spam
local function autoSpam()
    while isAutoSpamEnabled do
        attackEvent:FireServer() -- Mengirim serangan
        wait(attackSpeed) -- Menggunakan slider yang diatur oleh pemain
    end
end

-- Menjalankan fungsi AutoParry dan AutoSpam dalam coroutine terpisah
coroutine.wrap(function()
    while true do
        if isAutoParryEnabled then
            autoParry()
        end
        wait(0.1) -- Tunggu sebelum memeriksa lagi
    end
end)()

coroutine.wrap(function()
    while true do
        if isAutoSpamEnabled then
            autoSpam()
        end
        wait(0.1) -- Tunggu sebelum memeriksa lagi
    end
end)()
