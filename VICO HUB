-- Memuat Orion Library
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source.lua"))()

-- Membuat window GUI utama
local Window = OrionLib:MakeWindow({Name = "Blade Ball AutoParry & AutoSpam", HidePremium = false})

-- Tombol untuk AutoParry dan AutoSpam
local isAutoParryEnabled = false
local isAutoSpamEnabled = false
local attackSpeed = 0.1

-- Menambahkan tab dan elemen GUI
local Tab = Window:MakeTab({
    Name = "Auto Features",
    Icon = "rbxassetid://6035002451",  -- Ganti dengan asset ID yang diinginkan
    Premium = false
})

Tab:AddToggle({
    Name = "Toggle Auto Parry",
    Default = false,
    Callback = function(Value)
        isAutoParryEnabled = Value
        print("Auto Parry: ", isAutoParryEnabled and "ON" or "OFF")
        if isAutoParryEnabled then
            autoParry()
        end
    end
})

Tab:AddToggle({
    Name = "Toggle Auto Spam",
    Default = false,
    Callback = function(Value)
        isAutoSpamEnabled = Value
        print("Auto Spam: ", isAutoSpamEnabled and "ON" or "OFF")
        if isAutoSpamEnabled then
            autoSpam()
        end
    end
})

Tab:AddSlider({
    Name = "Spam Speed",
    Min = 0.05,
    Max = 1,
    Default = 0.1,
    Increment = 0.05,
    Callback = function(Value)
        attackSpeed = Value
        print("Attack Speed: ", attackSpeed)
    end
})

-- Event parry dan attack dari ReplicatedStorage
local parryEvent = game.ReplicatedStorage:WaitForChild("ParryEvent")
local attackEvent = game.ReplicatedStorage:WaitForChild("AttackEvent")

if not parryEvent or not attackEvent then
    error("ParryEvent or AttackEvent not found in ReplicatedStorage.")
end

local local_player = game.Players.LocalPlayer
local lastParryTime = tick()
local parryThrottle = 0.1

-- Fungsi untuk menemukan entitas terdekat
local function getClosestEntity()
    local closest
    local max_distance = math.huge
    for _, entity in ipairs(workspace.Alive:GetChildren()) do
        if entity.Name ~= local_player.Name and entity:FindFirstChild("HumanoidRootPart") then
            local distance = (local_player.Character.PrimaryPart.Position - entity.HumanoidRootPart.Position).Magnitude
            if distance < max_distance then
                closest = entity
                max_distance = distance
            end
        end
    end
    return closest
end

-- Fungsi untuk Auto Parry
local function autoParry()
    while isAutoParryEnabled do
        local closest_Entity = getClosestEntity()
        if closest_Entity and tick() - lastParryTime >= parryThrottle then
            parryEvent:FireServer(
                0.5,
                CFrame.new(workspace.CurrentCamera.CFrame.Position, closest_Entity.HumanoidRootPart.Position),
                {[closest_Entity.Name] = closest_Entity.HumanoidRootPart.Position}
            )
            lastParryTime = tick()
        end
        wait(0.1)
    end
end

-- Fungsi untuk Auto Spam
local function autoSpam()
    while isAutoSpamEnabled do
        attackEvent:FireServer()
        wait(attackSpeed)
    end
end

-- Menjalankan fungsi AutoParry dan AutoSpam
coroutine.wrap(function()
    while true do
        wait(0.1)
    end
end)()
